<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reservas - Cachoeira do Bom Jesus</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #e3f2fd 0%, #fff3e0 50%, #f3e5f5 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding: 20px 0; margin-bottom: 30px; }
        .header-content { display: flex; align-items: center; gap: 15px; }
        .logo-icon { font-size: 2.5rem; }
        .logo h1 { font-size: 1.8rem; font-weight: 700; color: #1565c0; }
        .logo p { font-size: 0.9rem; color: #666; margin-top: 2px; }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 30px; background: rgba(255, 255, 255, 0.7); padding: 8px; border-radius: 12px; }
        .nav-tab { padding: 12px 24px; border: none; background: transparent; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
        .nav-tab:hover { background: rgba(33, 150, 243, 0.1); }
        .nav-tab.active { background: linear-gradient(45deg, #2196f3, #00bcd4); color: white; box-shadow: 0 2px 10px rgba(33, 150, 243, 0.3); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .calendar-header { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 30px; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 12px; }
        .month-nav, #todayBtn { background: #2196f3; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; }
        .month-nav:hover, #todayBtn:hover { background: #1976d2; transform: scale(1.05); }
        #todayBtn { background: #00bcd4; font-size: 0.95rem; }
        #currentMonth { font-size: 1.5rem; font-weight: 600; color: #1565c0; min-width: 200px; text-align: center; }
        .calendar-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-bottom: 40px; }
        .unit-calendar { background: rgba(255, 255, 255, 0.9); border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .unit-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e3f2fd; }
        .unit-header h3 { font-size: 1.3rem; color: #1565c0; font-weight: 600; }
        .reserva-count { background: #e3f2fd; color: #1565c0; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; }
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 8px; }
        .weekdays div { text-align: center; font-weight: 600; font-size: 0.8rem; color: #666; padding: 8px 4px; }
        .days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; min-height: 240px; }
        .day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; position: relative; border: 2px solid transparent; background: #f5f5f5; color: #999; }
        .day:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .day.livre { background: #f5f5f5; color: #999; }
        .day.entrada { background: #c8e6c9 !important; color: #2e7d32 !important; border-color: #4caf50 !important; }
        .day.saida { background: #ffe0b2 !important; color: #ef6c00 !important; border-color: #ff9800 !important; }
        .day.sobreposicao { background: #e1bee7 !important; color: #7b1fa2 !important; border-color: #9c27b0 !important; }
        .day.hospedagem { background: #bbdefb !important; color: #1565c0 !important; border-color: #2196f3 !important; }
        .day.other-month { opacity: 0.3; }
        .day-badge { position: absolute; top: -5px; right: -5px; background: #f44336; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .legend-mini { margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.75rem; }
        .legend-mini div { display: flex; align-items: center; gap: 6px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; border: 2px solid; }
        .dot.entrada { background: #c8e6c9; border-color: #4caf50; }
        .dot.saida { background: #ffe0b2; border-color: #ff9800; }
        .dot.sobreposicao { background: #e1bee7; border-color: #9c27b0; }
        .dot.hospedagem { background: #bbdefb; border-color: #2196f3; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.9); border-radius: 12px; }
        .section-header h2 { color: #1565c0; font-size: 1.8rem; font-weight: 600; }
        .btn-primary { background: linear-gradient(45deg, #2196f3, #00bcd4); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4); }
        .btn-secondary { background: #f5f5f5; color: #666; border: 1px solid #ddd; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
        .btn-secondary:hover { background: #e0e0e0; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }
        .stat-number { display: block; font-size: 2.5rem; font-weight: 700; color: #1565c0; margin-bottom: 5px; }
        .stat-label { color: #666; font-weight: 500; font-size: 0.95rem; }
        .form-container { margin-bottom: 30px; }
        .form-card { background: rgba(255, 255, 255, 0.95); border-radius: 16px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .form-card h3 { color: #1565c0; font-size: 1.5rem; margin-bottom: 25px; font-weight: 600; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group label { font-weight: 500; color: #555; font-size: 0.95rem; }
        .form-group input, .form-group select, .form-group textarea { padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.9); }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #2196f3; box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1); }
        .form-actions { display: flex; justify-content: flex-end; gap: 15px; margin-top: 25px; padding-top: 20px; border-top: 1px solid #e0e0e0; }
        .table-container { background: rgba(255, 255, 255, 0.95); border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        thead tr { background: #f8f9fa; }
        th { padding: 15px 12px; text-align: left; font-weight: 600; color: #555; border-bottom: 2px solid #e0e0e0; }
        td { padding: 12px; border-bottom: 1px solid #f0f0f0; vertical-align: top; }
        tbody tr:hover { background: rgba(33, 150, 243, 0.05); }
        .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; text-align: center; display: inline-block; min-width: 80px; }
        .status-resv { background: #fff3cd; color: #856404; }
        .status-conf { background: #d4edda; color: #155724; }
        .status-canc { background: #f8d7da; color: #721c24; }
        .status-exec { background: #cce7ff; color: #004085; }
        .autocomplete-suggestion:hover,
        .autocomplete-suggestion.selected {
            background-color: #e3f2fd;
        }
        
        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }
        
        .suggestion-name {
            font-weight: 500;
            color: #1565c0;
        }
        
        .suggestion-details {
            font-size: 0.85rem;
            color: #666;
            margin-top: 2px;
        }
        
        /* Tooltip styles */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            line-height: 1.6;
            z-index: 1000;
            pointer-events: none;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .tooltip.show {
            opacity: 1;
        }
        
        .tooltip strong {
            color: #00bcd4;
            font-weight: 600;
        }
        
        .tooltip-divider {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin: 8px 0;
        }
        
        /* Timeline styles */
        .timeline-wrapper {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .timeline-grid {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 0;
            min-width: 800px;
        }
        
        .timeline-header {
            display: contents;
        }
        
        .timeline-unit-label {
            padding: 15px;
            font-weight: 600;
            color: #1565c0;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .timeline-days-header {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: minmax(40px, 1fr);
            gap: 2px;
            padding: 10px 2px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-left: none;
        }
        
        .timeline-day-header {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #666;
        }
        
        .timeline-day-header .day-number {
            display: block;
            font-size: 0.9rem;
            color: #333;
            margin-top: 2px;
        }
        
        .timeline-row {
            display: contents;
        }
        
        .timeline-unit-cell {
            padding: 15px;
            font-weight: 500;
            color: #555;
            background: white;
            border: 1px solid #e0e0e0;
            border-top: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .timeline-days-row {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: minmax(40px, 1fr);
            gap: 2px;
            padding: 2px;
            background: white;
            border: 1px solid #e0e0e0;
            border-left: none;
            border-top: none;
        }
        
        .timeline-day-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #f5f5f5;
            color: #999;
        }
        
        .timeline-day-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }
        
        .timeline-day-cell.entrada {
            background: #c8e6c9 !important;
            color: #2e7d32 !important;
            border: 2px solid #4caf50 !important;
        }
        
        .timeline-day-cell.saida {
            background: #ffe0b2 !important;
            color: #ef6c00 !important;
            border: 2px solid #ff9800 !important;
        }
        
        .timeline-day-cell.sobreposicao {
            background: #e1bee7 !important;
            color: #7b1fa2 !important;
            border: 2px solid #9c27b0 !important;
        }
        
        .timeline-day-cell.hospedagem {
            background: #bbdefb !important;
            color: #1565c0 !important;
            border: 2px solid #2196f3 !important;
        }
        
        /* Responsividade Mobile */
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .header {
                padding: 15px 0;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .logo-icon {
                font-size: 2rem;
            }
            
            .logo h1 {
                font-size: 1.4rem;
            }
            
            .logo p {
                font-size: 0.8rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
                gap: 5px;
                padding: 6px;
            }
            
            .nav-tab {
                padding: 10px 16px;
                font-size: 0.85rem;
                flex: 1 1 45%;
                text-align: center;
            }
            
            .calendar-header {
                flex-wrap: wrap;
                gap: 10px;
                padding: 15px;
            }
            
            #currentMonth, #timelineMonth {
                font-size: 1.2rem;
                min-width: auto;
                width: 100%;
                order: -1;
            }
            
            .month-nav, #todayBtn, #timelineTodayBtn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .btn-secondary {
                width: 100%;
                margin-left: 0 !important;
                margin-top: 10px;
            }
            
            .calendar-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .unit-calendar {
                padding: 15px;
            }
            
            .unit-header h3 {
                font-size: 1.1rem;
            }
            
            .weekdays div {
                font-size: 0.7rem;
                padding: 6px 2px;
            }
            
            .day {
                font-size: 0.8rem;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                padding: 15px;
            }
            
            .section-header h2 {
                font-size: 1.4rem;
            }
            
            .section-header > div {
                width: 100%;
                flex-direction: column;
            }
            
            .section-header button {
                width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .form-card {
                padding: 20px;
            }
            
            .form-card h3 {
                font-size: 1.3rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions button {
                width: 100%;
            }
            
            .table-container {
                padding: 10px;
                font-size: 0.85rem;
            }
            
            table {
                font-size: 0.75rem;
            }
            
            th, td {
                padding: 8px 6px;
            }
            
            .timeline-wrapper {
                padding: 10px;
            }
            
            .timeline-grid {
                grid-template-columns: 80px 1fr;
                min-width: 600px;
            }
            
            .timeline-unit-label, .timeline-unit-cell {
                padding: 10px;
                font-size: 0.85rem;
            }
            
            .timeline-day-header {
                font-size: 0.65rem;
            }
            
            .timeline-day-header .day-number {
                font-size: 0.8rem;
            }
            
            .timeline-day-cell {
                font-size: 0.65rem;
            }
            
            .tooltip {
                font-size: 0.75rem;
                padding: 10px 12px;
                max-width: 90vw;
                white-space: normal;
            }
            
            .legend-mini {
                grid-template-columns: 1fr;
                gap: 10px;
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .nav-tab {
                flex: 1 1 100%;
                padding: 12px;
            }
            
            #currentMonth, #timelineMonth {
                font-size: 1rem;
            }
            
            .calendar-header {
                padding: 10px;
            }
            
            .unit-calendar {
                padding: 10px;
            }
            
            .weekdays div {
                font-size: 0.6rem;
                padding: 4px 1px;
            }
            
            .day {
                font-size: 0.7rem;
                border-radius: 6px;
            }
            
            .section-header h2 {
                font-size: 1.2rem;
            }
            
            .stat-number {
                font-size: 1.8rem;
            }
            
            .form-card {
                padding: 15px;
            }
            
            .form-group input, .form-group select, .form-group textarea {
                padding: 10px 12px;
                font-size: 16px; /* Evita zoom no iOS */
            }
            
            table {
                font-size: 0.7rem;
            }
            
            th, td {
                padding: 6px 4px;
            }
            
            .status-badge {
                font-size: 0.7rem;
                padding: 3px 8px;
                min-width: 70px;
            }
            
            .timeline-grid {
                grid-template-columns: 70px 1fr;
            }
            
            .timeline-unit-label, .timeline-unit-cell {
                font-size: 0.75rem;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo-icon">üèñÔ∏è</div>
                <div class="logo">
                    <h1>Sistema de Reservas</h1>
                    <p>Cachoeira do Bom Jesus - Temporada 2025/2026</p>
                </div>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('calendario')">üìÖ Calend√°rio</button>
            <button class="nav-tab" onclick="showTab('timeline')">üìä Timeline</button>
            <button class="nav-tab" onclick="showTab('reservas')">üè† Reservas</button>
            <button class="nav-tab" onclick="showTab('contatos')">üìû Contatos</button>
        </nav>

        <div class="tab-content active" id="calendario">
            <div class="calendar-header">
                <button class="month-nav" onclick="changeMonth(-1)">‚Äπ</button>
                <h2 id="currentMonth">Setembro 2025</h2>
                <button class="month-nav" onclick="changeMonth(1)">‚Ä∫</button>
                <button id="todayBtn" onclick="goToToday()">Hoje</button>
                <button class="btn-secondary" onclick="gerarRelatorio()" style="background: #4caf50; color: white; margin-left: 20px;">üìÑ Gerar Relat√≥rio</button>
            </div>
            <div class="calendar-grid">
                <div class="unit-calendar">
                    <div class="unit-header">
                        <h3>üè† UN01</h3>
                        <span class="reserva-count" id="count-UN01">0 reservas</span>
                    </div>
                    <div class="calendar-days">
                        <div class="weekdays">
                            <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
                        </div>
                        <div class="days" id="days-UN01"></div>
                    </div>
                    <div class="legend-mini">
                        <div><span class="dot entrada"></span>Entrada</div>
                        <div><span class="dot saida"></span>Sa√≠da</div>
                        <div><span class="dot sobreposicao"></span>Sobreposi√ß√£o</div>
                        <div><span class="dot hospedagem"></span>Hospedagem</div>
                    </div>
                </div>
                <div class="unit-calendar">
                    <div class="unit-header">
                        <h3>üè† UN02</h3>
                        <span class="reserva-count" id="count-UN02">0 reservas</span>
                    </div>
                    <div class="calendar-days">
                        <div class="weekdays">
                            <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
                        </div>
                        <div class="days" id="days-UN02"></div>
                    </div>
                    <div class="legend-mini">
                        <div><span class="dot entrada"></span>Entrada</div>
                        <div><span class="dot saida"></span>Sa√≠da</div>
                        <div><span class="dot sobreposicao"></span>Sobreposi√ß√£o</div>
                        <div><span class="dot hospedagem"></span>Hospedagem</div>
                    </div>
                </div>
                <div class="unit-calendar">
                    <div class="unit-header">
                        <h3>üè† UN03</h3>
                        <span class="reserva-count" id="count-UN03">0 reservas</span>
                    </div>
                    <div class="calendar-days">
                        <div class="weekdays">
                            <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
                        </div>
                        <div class="days" id="days-UN03"></div>
                    </div>
                    <div class="legend-mini">
                        <div><span class="dot entrada"></span>Entrada</div>
                        <div><span class="dot saida"></span>Sa√≠da</div>
                        <div><span class="dot sobreposicao"></span>Sobreposi√ß√£o</div>
                        <div><span class="dot hospedagem"></span>Hospedagem</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="timeline">
            <div class="section-header">
                <h2>Timeline de Reservas</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="month-nav" onclick="changeTimelineMonth(-1)">‚Äπ</button>
                    <span id="timelineMonth" style="font-weight: bold; min-width: 150px; text-align: center;">Dezembro 2025</span>
                    <button class="month-nav" onclick="changeTimelineMonth(1)">‚Ä∫</button>
                    <button id="timelineTodayBtn" onclick="goToTimelineToday()" style="margin-left: 10px;">Hoje</button>
                </div>
            </div>
            
            <div id="timelineContainer" style="padding: 20px; overflow-x: auto;">
                <!-- Timeline ser√° renderizada aqui -->
            </div>
            
            <div class="legend-mini" style="margin-top: 20px; padding: 0 20px;">
                <div><span class="dot entrada"></span>Entrada</div>
                <div><span class="dot saida"></span>Sa√≠da</div>
                <div><span class="dot sobreposicao"></span>Sobreposi√ß√£o</div>
                <div><span class="dot hospedagem"></span>Hospedagem</div>
            </div>
        </div>

        <div class="tab-content" id="reservas">
            <div class="section-header">
                <h2>Gerenciar Reservas</h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-secondary" onclick="exportarBackup()" style="background: #4caf50; color: white;">üì• Exportar Backup</button>
                    <button class="btn-secondary" onclick="showImportBackup()" style="background: #ff9800; color: white;">üì§ Importar Backup</button>
                    <button class="btn-secondary" onclick="limparTodosDados()" style="background: #f44336; color: white;">üóëÔ∏è Limpar Tudo</button>
                    <button class="btn-primary" onclick="showReservaForm()">+ Nova Reserva</button>
                </div>
            </div>

            <!-- Import Backup Form -->
            <div class="form-container" id="importBackupForm" style="display: none;">
                <div class="form-card">
                    <h3>Importar Backup JSON</h3>
                    <p>Selecione um arquivo de backup (.json) para restaurar os dados:</p>
                    <input type="file" id="backupFile" accept=".json" style="margin: 15px 0; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; width: 100%;">
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="hideImportBackup()">Cancelar</button>
                        <button type="button" class="btn-primary" onclick="importarBackup()">Importar Backup</button>
                    </div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-reservas">0</span>
                    <span class="stat-label">Total</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="confirmadas">0</span>
                    <span class="stat-label">Confirmadas</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="reservadas">0</span>
                    <span class="stat-label">Reservas</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="executadas">0</span>
                    <span class="stat-label">Executadas</span>
                </div>
            </div>
            <div class="form-container" id="reservaForm" style="display: none;">
                <div class="form-card">
                    <h3 id="formTitle">Nova Reserva</h3>
                    <form id="reservaFormElement">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nome do Cliente *</label>
                                <div style="position: relative;">
                                    <input type="text" id="nome" required placeholder="Digite o nome do cliente..." autocomplete="off">
                                    <div id="nomeSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e0e0e0; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>WhatsApp</label>
                                <input type="text" id="whatsapp" placeholder="5548999606725">
                            </div>
                            <div class="form-group">
                                <label>Pa√≠s</label>
                                <input type="text" id="pais" value="Brasil">
                            </div>
                            <div class="form-group">
                                <label>Unidade *</label>
                                <select id="unidade" required>
                                    <option value="">Selecione</option>
                                    <option value="UN01">UN01</option>
                                    <option value="UN02">UN02</option>
                                    <option value="UN03">UN03</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Check-in (14h) *</label>
                                <input type="date" id="checkin" required>
                            </div>
                            <div class="form-group">
                                <label>Check-out (10h) *</label>
                                <input type="date" id="checkout" required>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="status">
                                    <option value="Resv">Reserva</option>
                                    <option value="Conf">Confirmada</option>
                                    <option value="Canc">Cancelada</option>
                                    <option value="Exec">Executada</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Valor Total (R$)</label>
                                <input type="number" id="valor" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label>Valor do Sinal (R$)</label>
                                <input type="number" id="valorSinal" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label>Data do Pagamento</label>
                                <input type="date" id="dataPagamento">
                            </div>
                            <div class="form-group">
                                <label>Forma de Pagamento</label>
                                <select id="formaPagamento">
                                    <option value="">Selecione</option>
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="PIX">PIX</option>
                                    <option value="Cart√£o Cr√©dito">Cart√£o de Cr√©dito</option>
                                    <option value="Cart√£o D√©bito">Cart√£o de D√©bito</option>
                                    <option value="Transfer√™ncia">Transfer√™ncia Banc√°ria</option>
                                    <option value="Boleto">Boleto</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Observa√ß√µes</label>
                            <textarea id="observacoes" rows="3" placeholder="Informa√ß√µes adicionais..."></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="hideReservaForm()">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Reserva</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Unidade</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>Status</th>
                            <th>Valor</th>
                            <th>Sinal</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="reservasTable">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #666; padding: 40px;">
                                Nenhuma reserva cadastrada. Clique em "+ Nova Reserva" para come√ßar.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="contatos">
            <div class="section-header">
                <h2>Lista de Contatos</h2>
                <button class="btn-primary" onclick="showImportForm()">üìã Importar Lista</button>
            </div>
            <div class="form-container" id="importForm" style="display: none;">
                <div class="form-card">
                    <h3>Importar Lista de Contatos</h3>
                    <p>Cole sua lista no formato: NOME-WHATSAPP-PAIS-TEMPO-UNIDADE-STATUS</p>
                    <p style="font-style: italic; color: #666; font-size: 0.85rem; margin-bottom: 15px;">
                        Exemplo: JO√ÉO-5548999606725-Brasil-2526-UN01-Resv
                    </p>
                    <textarea id="importText" rows="10" placeholder="Cole aqui sua lista de contatos..."></textarea>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="hideImportForm()">Cancelar</button>
                        <button type="button" class="btn-primary" onclick="importContatos()">Importar</button>
                    </div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-contatos">0</span>
                    <span class="stat-label">Total Contatos</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="com-whatsapp">0</span>
                    <span class="stat-label">Com WhatsApp</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="aguardando">0</span>
                    <span class="stat-label">Aguardando</span>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>WhatsApp</th>
                            <th>Pa√≠s</th>
                            <th>Tempo</th>
                            <th>Unidade Pref.</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="contatosTable">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #666; padding: 40px;">
                                Nenhum contato cadastrado. Use o bot√£o "Importar Lista" para adicionar contatos.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let currentMonth = new Date();
        let currentTimelineMonth = new Date();
        let reservas = [];
        let contatos = [];
        let currentEditingId = null;

        // Fun√ß√£o auxiliar para fazer parsing correto de datas sem problemas de timezone
        function parseDate(dateString) {
            // dateString no formato "YYYY-MM-DD"
            const parts = dateString.split('-');
            const year = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1;  // M√™s √© 0-indexed (0=Jan, 11=Dez)
            const day = parseInt(parts[2], 10);
            return new Date(year, month, day);
        }

        function loadData() {
            try {
                const reservasData = localStorage.getItem('reservas');
                const contatosData = localStorage.getItem('contatos');
                reservas = reservasData ? JSON.parse(reservasData) : [];
                contatos = contatosData ? JSON.parse(contatosData) : [];
                reservas = reservas.filter(r => r && r.id && r.nome && r.unidade);
                contatos = contatos.filter(c => c && c.id && c.nome);
                reservas.forEach(r => r.valor = parseFloat(r.valor) || 0);
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                reservas = []; contatos = [];
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateCalendar();
            renderTimeline();
            updateStats();
            updateReservasTable();
            updateContatosTable();
            updateContatosStats();
            setupEventListeners();
            
            // Aviso ao sair/atualizar a p√°gina
            window.addEventListener('beforeunload', function(e) {
                // Verificar se h√° dados para fazer backup
                if (reservas.length > 0 || contatos.length > 0) {
                    const message = 'Lembre-se de fazer backup dos seus dados! Deseja realmente sair?';
                    e.preventDefault();
                    e.returnValue = message;
                    return message;
                }
            });
        });

        function setupEventListeners() {
            document.getElementById('reservaFormElement').addEventListener('submit', handleReservaSubmit);
            const today = new Date().toISOString().split('T')[0];
            const checkinInput = document.getElementById('checkin');
            const checkoutInput = document.getElementById('checkout');
            checkinInput.min = today;
            checkinInput.addEventListener('change', function() {
                const checkinDate = new Date(this.value);
                checkinDate.setDate(checkinDate.getDate() + 1);
                checkoutInput.min = checkinDate.toISOString().split('T')[0];
            });
            
            // Configurar autocomplete
            setupAutocomplete();
        }

        function setupAutocomplete() {
            const nomeInput = document.getElementById('nome');
            const suggestionsContainer = document.getElementById('nomeSuggestions');
            let selectedSuggestionIndex = -1;
            let currentSuggestions = [];

            nomeInput.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length < 2) {
                    hideSuggestions();
                    return;
                }

                // Buscar contatos que correspondem √† consulta
                currentSuggestions = contatos.filter(contato => 
                    contato.nome && contato.nome.toLowerCase().includes(query)
                );

                if (currentSuggestions.length > 0) {
                    showSuggestions(currentSuggestions);
                } else {
                    hideSuggestions();
                }
            });

            nomeInput.addEventListener('keydown', function(e) {
                if (currentSuggestions.length === 0) return;

                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        selectedSuggestionIndex = Math.min(selectedSuggestionIndex + 1, currentSuggestions.length - 1);
                        updateSelectedSuggestion();
                        break;
                    
                    case 'ArrowUp':
                        e.preventDefault();
                        selectedSuggestionIndex = Math.max(selectedSuggestionIndex - 1, -1);
                        updateSelectedSuggestion();
                        break;
                    
                    case 'Enter':
                        e.preventDefault();
                        if (selectedSuggestionIndex >= 0) {
                            selectSuggestion(currentSuggestions[selectedSuggestionIndex]);
                        }
                        break;
                    
                    case 'Escape':
                        hideSuggestions();
                        break;
                }
            });

            // Fechar sugest√µes ao clicar fora
            document.addEventListener('click', function(e) {
                if (!nomeInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                    hideSuggestions();
                }
            });

            function showSuggestions(suggestions) {
                suggestionsContainer.innerHTML = '';
                selectedSuggestionIndex = -1;

                suggestions.forEach((contato, index) => {
                    const suggestionDiv = document.createElement('div');
                    suggestionDiv.style.cssText = 'padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f0f0f0; transition: background-color 0.2s ease;';
                    
                    suggestionDiv.innerHTML = `
                        <div style="font-weight: 500; color: #1565c0;">${contato.nome}</div>
                        <div style="font-size: 0.85rem; color: #666; margin-top: 2px;">
                            ${contato.whatsapp ? `üì± ${contato.whatsapp}` : 'Sem WhatsApp'}
                            ${contato.pais ? ` ‚Ä¢ ${contato.pais}` : ''}
                            ${contato.unidade ? ` ‚Ä¢ Pref: ${contato.unidade}` : ''}
                        </div>
                    `;

                    suggestionDiv.addEventListener('mouseenter', function() {
                        this.style.backgroundColor = '#e3f2fd';
                    });

                    suggestionDiv.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = 'transparent';
                    });

                    suggestionDiv.addEventListener('click', () => selectSuggestion(contato));
                    suggestionsContainer.appendChild(suggestionDiv);
                });

                suggestionsContainer.style.display = 'block';
            }

            function hideSuggestions() {
                suggestionsContainer.style.display = 'none';
                selectedSuggestionIndex = -1;
                currentSuggestions = [];
            }

            function updateSelectedSuggestion() {
                const suggestions = suggestionsContainer.querySelectorAll('div');
                suggestions.forEach((suggestion, index) => {
                    if (index === selectedSuggestionIndex) {
                        suggestion.style.backgroundColor = '#e3f2fd';
                    } else {
                        suggestion.style.backgroundColor = 'transparent';
                    }
                });
            }

            function selectSuggestion(contato) {
                // Preencher os campos do formul√°rio
                document.getElementById('nome').value = contato.nome;
                
                if (contato.whatsapp && contato.whatsapp.trim()) {
                    document.getElementById('whatsapp').value = contato.whatsapp;
                }
                
                if (contato.pais && contato.pais.trim()) {
                    document.getElementById('pais').value = contato.pais;
                }
                
                // Se o contato tem uma unidade preferida, pr√©-selecionar
                if (contato.unidade && contato.unidade.trim()) {
                    document.getElementById('unidade').value = contato.unidade;
                }

                hideSuggestions();
                
                // Mostrar feedback visual
                nomeInput.style.borderColor = '#4caf50';
                setTimeout(() => {
                    nomeInput.style.borderColor = '#e0e0e0';
                }, 1000);

                // Focar no pr√≥ximo campo
                document.getElementById('checkin').focus();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            if (tabName === 'calendario') updateCalendar();
            else if (tabName === 'reservas') { updateReservasTable(); updateStats(); }
            else if (tabName === 'contatos') { updateContatosTable(); updateContatosStats(); }
        }

        function updateCalendar() {
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            document.getElementById('currentMonth').textContent = `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
            ['UN01', 'UN02', 'UN03'].forEach(unit => {
                renderCalendarForUnit(unit);
                updateUnitReservaCount(unit);
            });
        }

        function renderCalendarForUnit(unit) {
            const daysContainer = document.getElementById(`days-${unit}`);
            daysContainer.innerHTML = '';
            const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dayElement = document.createElement('div');
                dayElement.className = 'day';
                dayElement.textContent = date.getDate();
                if (date.getMonth() !== currentMonth.getMonth()) dayElement.classList.add('other-month');
                const dayReservas = getReservasForDate(unit, date);
                const status = getDayStatus(unit, date);
                dayElement.classList.add(status);
                
                // Adicionar tooltip se houver reservas
                if (status !== 'livre') {
                    dayElement.dataset.unit = unit;
                    dayElement.dataset.date = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    dayElement.addEventListener('mouseenter', showTooltip);
                    dayElement.addEventListener('mouseleave', hideTooltip);
                    dayElement.addEventListener('mousemove', moveTooltip);
                }
                
                if (dayReservas.length > 1) {
                    const badge = document.createElement('div');
                    badge.className = 'day-badge';
                    badge.textContent = dayReservas.length;
                    dayElement.appendChild(badge);
                }
                daysContainer.appendChild(dayElement);
            }
        }

        function getReservasForDate(unit, date) {
            return reservas.filter(reserva => {
                if (reserva.unidade !== unit || reserva.status === 'Canc') return false;
                const checkinDate = parseDate(reserva.checkin);
                const checkoutDate = parseDate(reserva.checkout);
                const targetDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                return targetDate >= checkinDate && targetDate < checkoutDate;
            });
        }

        function getDayStatus(unit, date) {
            const targetDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            
            // Buscar TODAS as reservas da unidade (n√£o apenas as "ativas" no dia)
            const todasReservas = reservas.filter(r => r.unidade === unit && r.status !== 'Canc');
            
            let entradas = [];
            let saidas = [];
            let hospedagens = [];
            
            todasReservas.forEach(reserva => {
                const checkinDate = parseDate(reserva.checkin);
                const checkoutDate = parseDate(reserva.checkout);
                
                // Verificar se √© dia de entrada
                if (targetDate.getTime() === checkinDate.getTime()) {
                    entradas.push(reserva);
                }
                
                // Verificar se √© dia de sa√≠da
                if (targetDate.getTime() === checkoutDate.getTime()) {
                    saidas.push(reserva);
                }
                
                // Verificar se est√° hospedado (entre entrada e sa√≠da, excluindo checkout)
                if (targetDate >= checkinDate && targetDate < checkoutDate) {
                    hospedagens.push(reserva);
                }
            });
            
            // Determinar o status visual
            if (entradas.length > 0 && saidas.length > 0) {
                return 'sobreposicao';  // Entrada e sa√≠da no mesmo dia
            } else if (entradas.length > 0) {
                return 'entrada';  // Apenas entrada
            } else if (saidas.length > 0) {
                return 'saida';  // Apenas sa√≠da
            } else if (hospedagens.length > 0) {
                return 'hospedagem';  // Est√° hospedado
            } else {
                return 'livre';  // Dia livre
            }
        }

        // Fun√ß√µes de Tooltip
        let tooltipElement = null;

        function createTooltip() {
            if (!tooltipElement) {
                tooltipElement = document.createElement('div');
                tooltipElement.className = 'tooltip';
                document.body.appendChild(tooltipElement);
            }
            return tooltipElement;
        }

        function showTooltip(event) {
            const dayElement = event.currentTarget;
            const unit = dayElement.dataset.unit;
            const dateStr = dayElement.dataset.date;
            const date = parseDate(dateStr);
            
            const tooltip = createTooltip();
            const tooltipContent = getTooltipContent(unit, date);
            
            if (tooltipContent) {
                tooltip.innerHTML = tooltipContent;
                tooltip.classList.add('show');
                moveTooltip(event);
            }
        }

        function hideTooltip() {
            if (tooltipElement) {
                tooltipElement.classList.remove('show');
            }
        }

        function moveTooltip(event) {
            if (tooltipElement && tooltipElement.classList.contains('show')) {
                const x = event.clientX + 15;
                const y = event.clientY + 15;
                tooltipElement.style.left = x + 'px';
                tooltipElement.style.top = y + 'px';
            }
        }

        function getTooltipContent(unit, date) {
            const targetDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const todasReservas = reservas.filter(r => r.unidade === unit && r.status !== 'Canc');
            
            let entradas = [];
            let saidas = [];
            let hospedagens = [];
            
            todasReservas.forEach(reserva => {
                const checkinDate = parseDate(reserva.checkin);
                const checkoutDate = parseDate(reserva.checkout);
                
                if (targetDate.getTime() === checkinDate.getTime()) {
                    entradas.push(reserva);
                }
                
                if (targetDate.getTime() === checkoutDate.getTime()) {
                    saidas.push(reserva);
                }
                
                if (targetDate >= checkinDate && targetDate < checkoutDate) {
                    hospedagens.push(reserva);
                }
            });
            
            let content = '';
            
            // Sobreposi√ß√£o (entrada e sa√≠da no mesmo dia)
            if (entradas.length > 0 && saidas.length > 0) {
                content += '<strong>üîÑ SOBREPOSI√á√ÉO</strong><br>';
                
                saidas.forEach(reserva => {
                    content += `<div class="tooltip-divider"></div>`;
                    content += `<strong>üì§ SA√çDA:</strong> ${reserva.nome}<br>`;
                    if (reserva.whatsapp) content += `üì± ${reserva.whatsapp}<br>`;
                    content += `üè† ${reserva.unidade}<br>`;
                    content += `üìÖ ${formatDate(reserva.checkin)} ‚Üí ${formatDate(reserva.checkout)}`;
                });
                
                entradas.forEach(reserva => {
                    content += `<div class="tooltip-divider"></div>`;
                    content += `<strong>üì• ENTRADA:</strong> ${reserva.nome}<br>`;
                    if (reserva.whatsapp) content += `üì± ${reserva.whatsapp}<br>`;
                    content += `üè† ${reserva.unidade}<br>`;
                    content += `üìÖ ${formatDate(reserva.checkin)} ‚Üí ${formatDate(reserva.checkout)}`;
                });
            }
            // Apenas entrada
            else if (entradas.length > 0) {
                entradas.forEach((reserva, index) => {
                    if (index > 0) content += `<div class="tooltip-divider"></div>`;
                    content += `<strong>üì• ENTRADA:</strong> ${reserva.nome}<br>`;
                    if (reserva.whatsapp) content += `üì± ${reserva.whatsapp}<br>`;
                    content += `üè† ${reserva.unidade}<br>`;
                    content += `üìÖ ${formatDate(reserva.checkin)} ‚Üí ${formatDate(reserva.checkout)}<br>`;
                    content += `üí∞ R$ ${reserva.valor.toFixed(2)}`;
                });
            }
            // Apenas sa√≠da
            else if (saidas.length > 0) {
                saidas.forEach((reserva, index) => {
                    if (index > 0) content += `<div class="tooltip-divider"></div>`;
                    content += `<strong>üì§ SA√çDA:</strong> ${reserva.nome}<br>`;
                    if (reserva.whatsapp) content += `üì± ${reserva.whatsapp}<br>`;
                    content += `üè† ${reserva.unidade}<br>`;
                    content += `üìÖ ${formatDate(reserva.checkin)} ‚Üí ${formatDate(reserva.checkout)}<br>`;
                    content += `üí∞ R$ ${reserva.valor.toFixed(2)}`;
                });
            }
            // Hospedagem
            else if (hospedagens.length > 0) {
                hospedagens.forEach((reserva, index) => {
                    if (index > 0) content += `<div class="tooltip-divider"></div>`;
                    content += `<strong>üè† HOSPEDAGEM:</strong> ${reserva.nome}<br>`;
                    if (reserva.whatsapp) content += `üì± ${reserva.whatsapp}<br>`;
                    content += `üè† ${reserva.unidade}<br>`;
                    content += `üìÖ ${formatDate(reserva.checkin)} ‚Üí ${formatDate(reserva.checkout)}<br>`;
                    content += `üí∞ R$ ${reserva.valor.toFixed(2)}`;
                });
            }
            
            return content;
        }

        function updateUnitReservaCount(unit) {
            const countElement = document.getElementById(`count-${unit}`);
            if (countElement) {
                const count = reservas.filter(r => r.unidade === unit && r.status !== 'Canc').length;
                countElement.textContent = `${count} reservas`;
            }
        }

        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            updateCalendar();
        }
        
        // Fun√ß√µes da Timeline
        function changeTimelineMonth(direction) {
            currentTimelineMonth.setMonth(currentTimelineMonth.getMonth() + direction);
            renderTimeline();
        }
        
        function goToTimelineToday() {
            currentTimelineMonth = new Date();
            renderTimeline();
        }
        
        function renderTimeline() {
            const container = document.getElementById('timelineContainer');
            const monthLabel = document.getElementById('timelineMonth');
            
            if (!container || !monthLabel) return;
            
            const year = currentTimelineMonth.getFullYear();
            const month = currentTimelineMonth.getMonth();
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                              'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            monthLabel.textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            let html = '<div class="timeline-wrapper"><div class="timeline-grid">';
            
            // Cabe√ßalho
            html += '<div class="timeline-header">';
            html += '<div class="timeline-unit-label">Unidade</div>';
            html += '<div class="timeline-days-header">';
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayName = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'][date.getDay()];
                html += `<div class="timeline-day-header">${dayName}<span class="day-number">${day}</span></div>`;
            }
            
            html += '</div></div>';
            
            // Linhas para cada unidade
            ['UN01', 'UN02', 'UN03'].forEach(unit => {
                html += '<div class="timeline-row">';
                html += `<div class="timeline-unit-cell">üè† ${unit}</div>`;
                html += '<div class="timeline-days-row">';
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const status = getDayStatus(unit, date);
                    
                    html += `<div class="timeline-day-cell ${status}" 
                                  data-unit="${unit}" 
                                  data-date="${dateStr}"
                                  onmouseenter="showTooltip(event)"
                                  onmouseleave="hideTooltip()"
                                  onmousemove="moveTooltip(event)">
                             </div>`;
                }
                
                html += '</div></div>';
            });
            
            html += '</div></div>';
            container.innerHTML = html;
        }

        function goToToday() {
            currentMonth = new Date();
            updateCalendar();
        }

        // Fun√ß√£o para gerar relat√≥rio
        function gerarRelatorio() {
            const mes = currentMonth.getMonth();
            const ano = currentMonth.getFullYear();
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            let relatorio = '';
            relatorio += '===========================================================================\n';
            relatorio += '                    RELATORIO DE RESERVAS E DISPONIBILIDADE\n';
            relatorio += '                    Cachoeira do Bom Jesus - Temporada 2025/2026\n';
            relatorio += '===========================================================================\n\n';
            relatorio += `Periodo: ${monthNames[mes]} de ${ano}\n`;
            relatorio += `Data de Geracao: ${new Date().toLocaleDateString('pt-BR')} as ${new Date().toLocaleTimeString('pt-BR')}\n\n`;
            
            // Estat√≠sticas gerais
            const reservasAtivas = reservas.filter(r => r.status !== 'Canc');
            const reservasConfirmadas = reservas.filter(r => r.status === 'Conf');
            const valorTotal = reservasAtivas.reduce((sum, r) => sum + (r.valor || 0), 0);
            
            relatorio += '---------------------------------------------------------------------------\n';
            relatorio += '                           ESTATISTICAS GERAIS\n';
            relatorio += '---------------------------------------------------------------------------\n\n';
            relatorio += `Total de Reservas Ativas: ${reservasAtivas.length}\n`;
            relatorio += `Reservas Confirmadas: ${reservasConfirmadas.length}\n`;
            relatorio += `Valor Total: R$ ${valorTotal.toFixed(2)}\n\n`;
            
            // Calcular dados de disponibilidade para todas as unidades
            const mesesTemporada = [
                { mes: 10, ano: 2025, nome: 'Nov/25' },
                { mes: 11, ano: 2025, nome: 'Dez/25' },
                { mes: 0, ano: 2026, nome: 'Jan/26' },
                { mes: 1, ano: 2026, nome: 'Fev/26' },
                { mes: 2, ano: 2026, nome: 'Mar/26' },
                { mes: 3, ano: 2026, nome: 'Abr/26' },
                { mes: 4, ano: 2026, nome: 'Mai/26' }
            ];
            
            const dadosDisponibilidade = {};
            
            ['UN01', 'UN02', 'UN03'].forEach(unit => {
                dadosDisponibilidade[unit] = {
                    meses: [],
                    totalDias: 0,
                    totalOcupados: 0,
                    totalLivres: 0,
                    taxaGeral: 0
                };
                
                mesesTemporada.forEach(mesInfo => {
                    const diasNoMes = new Date(mesInfo.ano, mesInfo.mes + 1, 0).getDate();
                    let diasOcupados = 0;
                    
                    for (let dia = 1; dia <= diasNoMes; dia++) {
                        const date = new Date(mesInfo.ano, mesInfo.mes, dia);
                        const reservasNoDia = getReservasForDate(unit, date);
                        if (reservasNoDia.length > 0) {
                            diasOcupados++;
                        }
                    }
                    
                    const diasLivres = diasNoMes - diasOcupados;
                    const taxaOcupacao = ((diasOcupados / diasNoMes) * 100).toFixed(1);
                    
                    dadosDisponibilidade[unit].meses.push({
                        nome: mesInfo.nome,
                        diasNoMes: diasNoMes,
                        diasOcupados: diasOcupados,
                        diasLivres: diasLivres,
                        taxaOcupacao: taxaOcupacao
                    });
                    
                    dadosDisponibilidade[unit].totalDias += diasNoMes;
                    dadosDisponibilidade[unit].totalOcupados += diasOcupados;
                });
                
                dadosDisponibilidade[unit].totalLivres = dadosDisponibilidade[unit].totalDias - dadosDisponibilidade[unit].totalOcupados;
                dadosDisponibilidade[unit].taxaGeral = ((dadosDisponibilidade[unit].totalOcupados / dadosDisponibilidade[unit].totalDias) * 100).toFixed(1);
            });
            
            // Reservas por unidade
            ['UN01', 'UN02', 'UN03'].forEach(unit => {
                const reservasUnit = reservasAtivas.filter(r => r.unidade === unit);
                
                relatorio += '===========================================================================\n';
                relatorio += `                                 ${unit}\n`;
                relatorio += '===========================================================================\n\n';
                
                if (reservasUnit.length === 0) {
                    relatorio += '  - Nenhuma reserva cadastrada para esta unidade.\n\n';
                } else {
                    relatorio += `  Total de Reservas: ${reservasUnit.length}\n\n`;
                    
                    // Ordenar por data de check-in
                    reservasUnit.sort((a, b) => parseDate(a.checkin) - parseDate(b.checkin));
                    
                    // Calcular valor total da unidade
                    const valorTotalUnit = reservasUnit.reduce((sum, r) => sum + (r.valor || 0), 0);
                    
                    reservasUnit.forEach((reserva, index) => {
                        relatorio += `  Reserva ${index + 1}\n`;
                        relatorio += `  Cliente: ${reserva.nome}\n`;
                        if (reserva.whatsapp) {
                            relatorio += `  WhatsApp: ${reserva.whatsapp}\n`;
                        }
                        if (reserva.pais && reserva.pais !== 'Brasil') {
                            relatorio += `  Pa√≠s: ${reserva.pais}\n`;
                        }
                        relatorio += `  Check-in: ${formatDate(reserva.checkin)}\n`;
                        relatorio += `  Check-out: ${formatDate(reserva.checkout)}\n`;
                        
                        const dias = Math.ceil((parseDate(reserva.checkout) - parseDate(reserva.checkin)) / (1000 * 60 * 60 * 24));
                        relatorio += `  Dura√ß√£o: ${dias} dia(s)\n`;
                        
                        const statusText = getStatusText(reserva.status);
                        relatorio += `  Status: ${statusText}\n`;
                        relatorio += `  Valor Total: R$ ${reserva.valor.toFixed(2)}\n`;
                        
                        if (reserva.valorSinal && reserva.valorSinal > 0) {
                            relatorio += `  Valor do Sinal: R$ ${reserva.valorSinal.toFixed(2)}\n`;
                            const saldo = reserva.valor - reserva.valorSinal;
                            relatorio += `  Saldo Restante: R$ ${saldo.toFixed(2)}\n`;
                        }
                        
                        if (reserva.dataPagamento) {
                            relatorio += `  Data do Pagamento: ${formatDate(reserva.dataPagamento)}\n`;
                        }
                        
                        if (reserva.formaPagamento) {
                            relatorio += `  Forma de Pagamento: ${reserva.formaPagamento}\n`;
                        }
                        
                        if (reserva.observacoes) {
                            relatorio += `  Obs: ${reserva.observacoes}\n`;
                        }
                        
                        relatorio += '\n';
                    });
                    
                    // Adicionar valor total da unidade
                    relatorio += '  ---------------------------------------------------------------------------\n';
                    relatorio += `  VALOR TOTAL DA ${unit}: R$ ${valorTotalUnit.toFixed(2)}\n`;
                    relatorio += '  ---------------------------------------------------------------------------\n\n';
                }
            });
            
            // Tabela de disponibilidade consolidada
            relatorio += '===========================================================================\n';
            relatorio += '           DISPONIBILIDADE DA TEMPORADA 2025/2026 (NOV/25 - MAI/26)\n';
            relatorio += '===========================================================================\n\n';
            
            // Cabe√ßalho da tabela
            relatorio += '  Unidade  - Nov/25 - Dez/25 - Jan/26 - Fev/26 - Mar/26 - Abr/26 - Mai/26 -  TOTAL\n';
            relatorio += '  ---------+--------+--------+--------+--------+--------+--------+--------+---------\n';
            
            // Linhas para cada unidade
            ['UN01', 'UN02', 'UN03'].forEach(unit => {
                const dados = dadosDisponibilidade[unit];
                
                // Linha de dias ocupados
                let linha = `  ${unit}     -`;
                dados.meses.forEach(m => {
                    linha += ` ${m.diasOcupados.toString().padStart(2, ' ')}/${m.diasNoMes} -`;
                });
                linha += ` ${dados.totalOcupados}/${dados.totalDias}\n`;
                relatorio += linha;
                
                // Linha de taxa de ocupa√ß√£o
                linha = `  Taxa (%) -`;
                dados.meses.forEach(m => {
                    linha += ` ${m.taxaOcupacao.padStart(5, ' ')} -`;
                });
                linha += ` ${dados.taxaGeral.padStart(5, ' ')}\n`;
                relatorio += linha;
                
                relatorio += '  ---------+--------+--------+--------+--------+--------+--------+--------+---------\n';
            });
            
            relatorio += '\n  Legenda: Dias Ocupados/Total de Dias no Mes\n\n';
            
            relatorio += '===========================================================================\n';
            relatorio += '                              FIM DO RELATORIO\n';
            relatorio += '===========================================================================\n';
            
            // Criar modal para exibir o relat√≥rio
            mostrarModalRelatorio(relatorio);
        }

        function mostrarModalRelatorio(relatorio) {
            // Criar modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 16px;
                padding: 30px;
                max-width: 900px;
                max-height: 90vh;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            `;
            
            const header = document.createElement('div');
            header.style.cssText = `
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 2px solid #e0e0e0;
            `;
            
            const title = document.createElement('h2');
            title.textContent = 'üìÑ Relat√≥rio de Reservas';
            title.style.cssText = 'color: #1565c0; margin: 0;';
            
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '‚úï';
            closeBtn.style.cssText = `
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: #666;
                padding: 0;
                width: 30px;
                height: 30px;
            `;
            closeBtn.onclick = () => document.body.removeChild(modal);
            
            header.appendChild(title);
            header.appendChild(closeBtn);
            
            const textArea = document.createElement('textarea');
            textArea.value = relatorio;
            textArea.readOnly = true;
            textArea.style.cssText = `
                flex: 1;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                padding: 15px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                resize: none;
                margin-bottom: 20px;
                line-height: 1.5;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = 'display: flex; gap: 10px; justify-content: flex-end;';
            
            const downloadBtn = document.createElement('button');
            downloadBtn.textContent = 'üíæ Baixar TXT';
            downloadBtn.className = 'btn-primary';
            downloadBtn.onclick = () => baixarRelatorio(relatorio);
            
            const printBtn = document.createElement('button');
            printBtn.textContent = 'üñ®Ô∏è Imprimir';
            printBtn.className = 'btn-secondary';
            printBtn.style.cssText = 'background: #2196f3; color: white;';
            printBtn.onclick = () => imprimirRelatorio(relatorio);
            
            buttonContainer.appendChild(downloadBtn);
            buttonContainer.appendChild(printBtn);
            
            modalContent.appendChild(header);
            modalContent.appendChild(textArea);
            modalContent.appendChild(buttonContainer);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }

        function baixarRelatorio(relatorio) {
            const blob = new Blob([relatorio], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const filename = `Relatorio_Reservas_${monthNames[currentMonth.getMonth()]}_${currentMonth.getFullYear()}.txt`;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function imprimirRelatorio(relatorio) {
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write('<html><head><title>Relat√≥rio de Reservas</title>');
            printWindow.document.write('<style>');
            printWindow.document.write('body { font-family: "Courier New", monospace; font-size: 12px; line-height: 1.5; padding: 20px; }');
            printWindow.document.write('pre { white-space: pre-wrap; word-wrap: break-word; }');
            printWindow.document.write('</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write('<pre>' + relatorio + '</pre>');
            printWindow.document.write('
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA-pnrL3UbNaAs48sgXhcO0tyIrcUmwMxI",
            authDomain: "cachoeira-reservas.firebaseapp.com",
            projectId: "cachoeira-reservas",
            storageBucket: "cachoeira-reservas.firebasestorage.app",
            messagingSenderId: "487018223797",
            appId: "1:487018223797:web:2fe1a7e31319c58adac6fc"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        window.auth = auth;
        window.db = db;
        
        console.log('üî• Firebase initialized');

        // Check authentication
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'index.html';
            } else {
                console.log('‚úÖ User authenticated:', user.email);
                addLogoutButton(user.email);
                syncWithFirestore();
            }
        });

        // Add logout button
        function addLogoutButton(email) {
            const header = document.querySelector('.header-content');
            if (header && !document.getElementById('logoutBtn')) {
                const logoutDiv = document.createElement('div');
                logoutDiv.style.marginLeft = 'auto';
                logoutDiv.style.display = 'flex';
                logoutDiv.style.alignItems = 'center';
                logoutDiv.style.gap = '15px';
                
                const userInfo = document.createElement('span');
                userInfo.style.color = '#666';
                userInfo.style.fontSize = '0.9rem';
                userInfo.textContent = email;
                
                const logoutBtn = document.createElement('button');
                logoutBtn.id = 'logoutBtn';
                logoutBtn.textContent = 'üö™ Sair';
                logoutBtn.className = 'btn-secondary';
                logoutBtn.style.padding = '8px 16px';
                logoutBtn.style.fontSize = '0.9rem';
                logoutBtn.onclick = async () => {
                    if (confirm('Deseja realmente sair?')) {
                        await signOut(auth);
                        window.location.href = 'index.html';
                    }
                };
                
                logoutDiv.appendChild(userInfo);
                logoutDiv.appendChild(logoutBtn);
                header.appendChild(logoutDiv);
            }
        }

        // Sync with Firestore
        async function syncWithFirestore() {
            try {
                // Load from Firestore
                const reservasSnap = await getDocs(collection(db, 'reservas'));
                const contatosSnap = await getDocs(collection(db, 'contatos'));
                
                const firestoreReservas = [];
                reservasSnap.forEach(doc => firestoreReservas.push({id: doc.id, ...doc.data()}));
                
                const firestoreContatos = [];
                contatosSnap.forEach(doc => firestoreContatos.push({id: doc.id, ...doc.data()}));
                
                // Merge with localStorage
                const localReservas = JSON.parse(localStorage.getItem('reservas') || '[]');
                const localContatos = JSON.parse(localStorage.getItem('contatos') || '[]');
                
                // If Firestore is empty but localStorage has data, upload to Firestore
                if (firestoreReservas.length === 0 && localReservas.length > 0) {
                    console.log('üì§ Uploading local data to Firestore...');
                    for (const reserva of localReservas) {
                        await addDoc(collection(db, 'reservas'), reserva);
                    }
                }
                
                if (firestoreContatos.length === 0 && localContatos.length > 0) {
                    for (const contato of localContatos) {
                        await addDoc(collection(db, 'contatos'), contato);
                    }
                }
                
                // If Firestore has data, use it
                if (firestoreReservas.length > 0) {
                    localStorage.setItem('reservas', JSON.stringify(firestoreReservas));
                    window.location.reload();
                }
                
                if (firestoreContatos.length > 0) {
                    localStorage.setItem('contatos', JSON.stringify(firestoreContatos));
                }
                
                console.log('‚úÖ Sync complete');
                
                // Intercept localStorage.setItem to also save to Firestore
                const originalSetItem = localStorage.setItem;
                localStorage.setItem = function(key, value) {
                    originalSetItem.call(this, key, value);
                    if (key === 'reservas' || key === 'contatos') {
                        syncToFirestore(key, value);
                    }
                };
                
                async function syncToFirestore(key, value) {
                    try {
                        const data = JSON.parse(value);
                        const collectionName = key;
                        
                        // Clear collection
                        const snapshot = await getDocs(collection(db, collectionName));
                        for (const docSnap of snapshot.docs) {
                            await deleteDoc(doc(db, collectionName, docSnap.id));
                        }
                        
                        // Add all items
                        for (const item of data) {
                            const {id, ...itemData} = item;
                            await addDoc(collection(db, collectionName), itemData);
                        }
                        
                        console.log(`‚úÖ Synced ${collectionName} to Firestore`);
                    } catch (error) {
                        console.error('Error syncing to Firestore:', error);
                    }
                }
                
            } catch (error) {
                console.error('Error syncing:', error);
            }
        }
    </script>

</body></html>');
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }

        function showReservaForm() {
            document.getElementById('reservaForm').style.display = 'block';
            document.getElementById('reservaFormElement').reset();
            document.getElementById('pais').value = 'Brasil';
            document.getElementById('status').value = 'Resv';
            document.getElementById('formTitle').textContent = 'Nova Reserva';
            currentEditingId = null;
            
            // Esconder sugest√µes do autocomplete
            document.getElementById('nomeSuggestions').style.display = 'none';
            
            document.getElementById('reservaForm').scrollIntoView({ behavior: 'smooth' });
            
            // Focar no campo nome ap√≥s um pequeno delay
            setTimeout(() => {
                document.getElementById('nome').focus();
            }, 300);
        }

        function hideReservaForm() {
            document.getElementById('reservaForm').style.display = 'none';
            currentEditingId = null;
        }

        function handleReservaSubmit(event) {
            event.preventDefault();
            try {
                const formData = {
                    id: currentEditingId || Date.now(),
                    nome: document.getElementById('nome').value.trim(),
                    whatsapp: document.getElementById('whatsapp').value.trim(),
                    pais: document.getElementById('pais').value.trim(),
                    unidade: document.getElementById('unidade').value,
                    checkin: document.getElementById('checkin').value,
                    checkout: document.getElementById('checkout').value,
                    status: document.getElementById('status').value,
                    valor: parseFloat(document.getElementById('valor').value) || 0,
                    valorSinal: parseFloat(document.getElementById('valorSinal').value) || 0,
                    dataPagamento: document.getElementById('dataPagamento').value,
                    formaPagamento: document.getElementById('formaPagamento').value,
                    observacoes: document.getElementById('observacoes').value.trim()
                };
                if (!formData.nome) { alert('Nome do cliente √© obrigat√≥rio!'); return; }
                if (!formData.unidade) { alert('Selecione uma unidade!'); return; }
                if (!formData.checkin || !formData.checkout) { alert('Datas de check-in e check-out s√£o obrigat√≥rias!'); return; }
                if (parseDate(formData.checkout) <= parseDate(formData.checkin)) { alert('A data de check-out deve ser posterior ao check-in!'); return; }
                const conflictResult = checkReservationConflicts(formData, currentEditingId);
                if (!conflictResult.valid) { alert(conflictResult.message); return; }
                if (currentEditingId) {
                    const index = reservas.findIndex(r => r.id === currentEditingId);
                    if (index !== -1) reservas[index] = formData;
                } else {
                    reservas.push(formData);
                }
                localStorage.setItem('reservas', JSON.stringify(reservas));
                updateReservasTable();
                updateStats();
                updateCalendar();
                hideReservaForm();
                alert('Reserva salva com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar reserva:', error);
                alert('Erro ao salvar reserva. Tente novamente.');
            }
        }

        function checkReservationConflicts(newReserva, editingId = null) {
            const checkinDate = parseDate(newReserva.checkin);
            const checkoutDate = parseDate(newReserva.checkout);
            const conflictingReservas = reservas.filter(reserva => {
                return reserva.unidade === newReserva.unidade && reserva.status !== 'Canc' && reserva.id !== editingId;
            });
            for (let existingReserva of conflictingReservas) {
                const existingCheckin = parseDate(existingReserva.checkin);
                const existingCheckout = parseDate(existingReserva.checkout);
                const hasOverlap = !(checkoutDate < existingCheckin || checkinDate > existingCheckout);
                if (hasOverlap) {
                    const sameCheckoutCheckinDate = isSameDay(checkoutDate, existingCheckin) || isSameDay(checkinDate, existingCheckout);
                    if (!sameCheckoutCheckinDate) {
                        return {
                            valid: false,
                            message: `CONFLITO: A reserva de "${newReserva.nome}" conflita com "${existingReserva.nome}" na ${newReserva.unidade}.\n\nS√≥ √© permitida sobreposi√ß√£o quando um cliente sai √†s 10h e outro entra √†s 14h no mesmo dia.`
                        };
                    }
                }
            }
            return { valid: true };
        }

        function isSameDay(date1, date2) {
            return date1.getFullYear() === date2.getFullYear() && date1.getMonth() === date2.getMonth() && date1.getDate() === date2.getDate();
        }

        function updateReservasTable() {
            const tbody = document.getElementById('reservasTable');
            tbody.innerHTML = '';
            if (reservas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #666; padding: 40px;">Nenhuma reserva cadastrada. Clique em "+ Nova Reserva" para come√ßar.</td></tr>';
                return;
            }
            reservas.forEach(reserva => {
                const valor = typeof reserva.valor === 'number' ? reserva.valor : parseFloat(reserva.valor) || 0;
                const valorSinal = typeof reserva.valorSinal === 'number' ? reserva.valorSinal : parseFloat(reserva.valorSinal) || 0;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${reserva.nome || 'Nome n√£o informado'}</td>
                    <td>${reserva.unidade || '-'}</td>
                    <td>${formatDate(reserva.checkin)}</td>
                    <td>${formatDate(reserva.checkout)}</td>
                    <td><span class="status-badge status-${(reserva.status || 'resv').toLowerCase()}">${getStatusText(reserva.status)}</span></td>
                    <td>R$ ${valor.toFixed(2)}</td>
                    <td>${valorSinal > 0 ? 'R$ ' + valorSinal.toFixed(2) : '-'}</td>
                    <td>
                        <button class="btn-secondary" onclick="editReserva(${reserva.id})" style="margin-right: 5px; padding: 4px 8px; font-size: 0.8rem;">Editar</button>
                        <button class="btn-secondary" onclick="deleteReserva(${reserva.id})" style="background: #f44336; color: white; padding: 4px 8px; font-size: 0.8rem;">Excluir</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateStats() {
            const total = reservas.length;
            const confirmadas = reservas.filter(r => r.status === 'Conf').length;
            const reservadas = reservas.filter(r => r.status === 'Resv').length;
            const executadas = reservas.filter(r => r.status === 'Exec').length;
            document.getElementById('total-reservas').textContent = total;
            document.getElementById('confirmadas').textContent = confirmadas;
            document.getElementById('reservadas').textContent = reservadas;
            document.getElementById('executadas').textContent = executadas;
        }

        function showImportForm() { document.getElementById('importForm').style.display = 'block'; }
        function hideImportForm() { document.getElementById('importForm').style.display = 'none'; }

        function importContatos() {
            const text = document.getElementById('importText').value.trim();
            if (!text) { alert('Cole a lista de contatos antes de importar.'); return; }
            const lines = text.split('\n').filter(line => line.trim());
            let imported = 0;
            let duplicados = 0;
            let erros = [];
            
            lines.forEach((line, index) => {
                const parts = line.trim().split('-');
                if (parts.length >= 6) {
                    const nomeNovo = parts[0].trim().toLowerCase();
                    const whatsappNovo = parts[1].trim();
                    
                    // Verificar duplicados mais rigorosa
                    const jaExiste = contatos.find(c => 
                        c.nome.toLowerCase() === nomeNovo || 
                        (c.whatsapp === whatsappNovo && whatsappNovo !== '')
                    );
                    
                    if (!jaExiste) {
                        const contato = {
                            id: Date.now() + Math.random() + index,
                            nome: parts[0].trim(),
                            whatsapp: parts[1].trim(),
                            pais: parts[2].trim(),
                            tempo: parts[3].trim(),
                            unidade: parts[4].trim(),
                            status: parts[5].trim()
                        };
                        contatos.push(contato);
                        imported++;
                    } else {
                        duplicados++;
                    }
                } else {
                    erros.push(`Linha ${index + 1}: "${line.trim()}" - Formato inv√°lido`);
                }
            });
            
            localStorage.setItem('contatos', JSON.stringify(contatos));
            updateContatosTable();
            updateContatosStats();
            hideImportForm();
            document.getElementById('importText').value = '';
            
            let message = `Importa√ß√£o conclu√≠da:\n‚úÖ ${imported} novos contatos\nüîÑ ${duplicados} duplicados ignorados`;
            if (erros.length > 0) {
                message += `\n‚ùå ${erros.length} erros encontrados:\n${erros.slice(0, 5).join('\n')}`;
                if (erros.length > 5) message += `\n... e mais ${erros.length - 5} erros.`;
            }
            alert(message);
        }

        function updateContatosTable() {
            const tbody = document.getElementById('contatosTable');
            tbody.innerHTML = '';
            if (contatos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666; padding: 40px;">Nenhum contato cadastrado. Use o bot√£o "Importar Lista" para adicionar contatos.</td></tr>';
                return;
            }
            contatos.forEach(contato => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${contato.nome}</td>
                    <td>${contato.whatsapp || '-'}</td>
                    <td>${contato.pais}</td>
                    <td>${contato.tempo}</td>
                    <td>${contato.unidade}</td>
                    <td><span class="status-badge status-${(contato.status || 'aguardando').toLowerCase()}">${getStatusText(contato.status)}</span></td>
                    <td><button class="btn-secondary" onclick="deleteContato('${contato.id}')" style="background: #f44336; color: white; padding: 4px 8px; font-size: 0.8rem;">Excluir</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateContatosStats() {
            const total = contatos.length;
            const comWhatsapp = contatos.filter(c => c.whatsapp && c.whatsapp.trim()).length;
            const aguardando = contatos.filter(c => c.status === 'Aguardando').length;
            document.getElementById('total-contatos').textContent = total;
            document.getElementById('com-whatsapp').textContent = comWhatsapp;
            document.getElementById('aguardando').textContent = aguardando;
        }

        function formatDate(dateString) {
            if (!dateString) return 'Data inv√°lida';
            try { 
                // CORRE√á√ÉO: N√£o adicionar hora, usar diretamente a data
                const parts = dateString.split('-');
                const year = parseInt(parts[0]);
                const month = parseInt(parts[1]) - 1;
                const day = parseInt(parts[2]);
                const date = new Date(year, month, day);
                return date.toLocaleDateString('pt-BR');
            }
            catch (error) { 
                console.error('Erro ao formatar data:', dateString, error);
                return 'Data inv√°lida'; 
            }
        }

        function getStatusText(status) {
            const statusMap = { 'Resv': 'Reserva', 'Conf': 'Confirmada', 'Canc': 'Cancelada', 'Exec': 'Executada', 'Aguardando': 'Aguardando' };
            return statusMap[status] || 'Reserva';
        }

        function editReserva(id) {
            const reserva = reservas.find(r => r.id == id); // Usar == para compara√ß√£o flex√≠vel
            if (!reserva) {
                alert('Reserva n√£o encontrada!');
                return;
            }
            
            document.getElementById('nome').value = reserva.nome || '';
            document.getElementById('whatsapp').value = reserva.whatsapp || '';
            document.getElementById('pais').value = reserva.pais || 'Brasil';
            document.getElementById('unidade').value = reserva.unidade || '';
            document.getElementById('checkin').value = reserva.checkin || '';
            document.getElementById('checkout').value = reserva.checkout || '';
            document.getElementById('status').value = reserva.status || 'Resv';
            document.getElementById('valor').value = reserva.valor || 0;
            document.getElementById('valorSinal').value = reserva.valorSinal || 0;
            document.getElementById('dataPagamento').value = reserva.dataPagamento || '';
            document.getElementById('formaPagamento').value = reserva.formaPagamento || '';
            document.getElementById('observacoes').value = reserva.observacoes || '';
            
            currentEditingId = id;
            document.getElementById('formTitle').textContent = 'Editar Reserva';
            document.getElementById('reservaForm').style.display = 'block';
            document.getElementById('reservaForm').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteReserva(id) {
            if (confirm('Tem certeza que deseja excluir esta reserva?')) {
                const index = reservas.findIndex(r => r.id == id); // Usar == para compara√ß√£o flex√≠vel
                if (index === -1) {
                    alert('Reserva n√£o encontrada!');
                    return;
                }
                
                reservas.splice(index, 1); // Usar splice em vez de filter
                localStorage.setItem('reservas', JSON.stringify(reservas));
                updateReservasTable();
                updateStats();
                updateCalendar();
                alert('Reserva exclu√≠da com sucesso!');
            }
        }

        function deleteContato(id) {
            if (confirm('Tem certeza que deseja excluir este contato?')) {
                const index = contatos.findIndex(c => c.id == id); // Usar == para compara√ß√£o flex√≠vel
                if (index === -1) {
                    alert('Contato n√£o encontrado!');
                    return;
                }
                
                contatos.splice(index, 1); // Usar splice em vez de filter
                localStorage.setItem('contatos', JSON.stringify(contatos));
                updateContatosTable();
                updateContatosStats();
                alert('Contato exclu√≠do com sucesso!');
            }
        }

        // Fun√ß√µes de Backup e Limpeza
        function exportarBackup() {
            try {
                const backup = {
                    versao: '1.0',
                    data: new Date().toISOString(),
                    reservas: reservas,
                    contatos: contatos,
                    totalReservas: reservas.length,
                    totalContatos: contatos.length
                };
                
                const dataStr = JSON.stringify(backup, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `backup-cachoeira-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                alert('Backup exportado com sucesso!');
            } catch (error) {
                console.error('Erro ao exportar backup:', error);
                alert('Erro ao exportar backup. Tente novamente.');
            }
        }

        function showImportBackup() {
            document.getElementById('importBackupForm').style.display = 'block';
        }

        function hideImportBackup() {
            document.getElementById('importBackupForm').style.display = 'none';
            document.getElementById('backupFile').value = '';
        }

        function importarBackup() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Selecione um arquivo de backup!');
                return;
            }
            
            if (!file.name.endsWith('.json')) {
                alert('Por favor, selecione um arquivo JSON v√°lido!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    // Validar estrutura do backup
                    if (!backup.reservas || !backup.contatos) {
                        alert('Arquivo de backup inv√°lido! Estrutura n√£o reconhecida.');
                        return;
                    }
                    
                    if (confirm(`Importar backup de ${backup.data ? new Date(backup.data).toLocaleDateString('pt-BR') : 'data desconhecida'}?\n\nReservas: ${backup.totalReservas || backup.reservas.length}\nContatos: ${backup.totalContatos || backup.contatos.length}\n\n‚ö†Ô∏è ATEN√á√ÉO: Isso substituir√° todos os dados atuais!`)) {
                        
                        reservas = Array.isArray(backup.reservas) ? backup.reservas : [];
                        contatos = Array.isArray(backup.contatos) ? backup.contatos : [];
                        
                        // Validar dados importados
                        reservas = reservas.filter(r => r && r.id && r.nome && r.unidade);
                        contatos = contatos.filter(c => c && c.id && c.nome);
                        
                        // Salvar no localStorage
                        localStorage.setItem('reservas', JSON.stringify(reservas));
                        localStorage.setItem('contatos', JSON.stringify(contatos));
                        
                        // Atualizar interface
                        updateCalendar();
                        updateReservasTable();
                        updateStats();
                        updateContatosTable();
                        updateContatosStats();
                        
                        hideImportBackup();
                        alert(`Backup importado com sucesso!\n\n‚úÖ ${reservas.length} reservas\n‚úÖ ${contatos.length} contatos`);
                    }
                    
                } catch (error) {
                    console.error('Erro ao importar backup:', error);
                    alert('Erro ao ler o arquivo de backup. Verifique se √© um arquivo JSON v√°lido.');
                }
            };
            
            reader.readAsText(file);
        }

        function limparTodosDados() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° APAGAR TODOS OS DADOS!\n\n‚Ä¢ Todas as reservas\n‚Ä¢ Todos os contatos\n‚Ä¢ Configura√ß√µes\n\nEsta a√ß√£o N√ÉO PODE SER DESFEITA!\n\nTem certeza que deseja continuar?')) {
                if (confirm('√öLTIMA CONFIRMA√á√ÉO:\n\nApagar PERMANENTEMENTE todos os dados?')) {
                    
                    // Limpar arrays
                    reservas = [];
                    contatos = [];
                    currentEditingId = null;
                    
                    // Limpar localStorage
                    localStorage.removeItem('reservas');
                    localStorage.removeItem('contatos');
                    
                    // Atualizar interface
                    updateCalendar();
                    updateReservasTable();
                    updateStats();
                    updateContatosTable();
                    updateContatosStats();
                    
                    // Esconder formul√°rios abertos
                    hideReservaForm();
                    hideImportForm();
                    hideImportBackup();
                    
                    alert('‚úÖ Todos os dados foram apagados com sucesso!');
                }
            }
        }
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA-pnrL3UbNaAs48sgXhcO0tyIrcUmwMxI",
            authDomain: "cachoeira-reservas.firebaseapp.com",
            projectId: "cachoeira-reservas",
            storageBucket: "cachoeira-reservas.firebasestorage.app",
            messagingSenderId: "487018223797",
            appId: "1:487018223797:web:2fe1a7e31319c58adac6fc"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        window.auth = auth;
        window.db = db;
        
        console.log('üî• Firebase initialized');

        // Check authentication
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'index.html';
            } else {
                console.log('‚úÖ User authenticated:', user.email);
                addLogoutButton(user.email);
                syncWithFirestore();
            }
        });

        // Add logout button
        function addLogoutButton(email) {
            const header = document.querySelector('.header-content');
            if (header && !document.getElementById('logoutBtn')) {
                const logoutDiv = document.createElement('div');
                logoutDiv.style.marginLeft = 'auto';
                logoutDiv.style.display = 'flex';
                logoutDiv.style.alignItems = 'center';
                logoutDiv.style.gap = '15px';
                
                const userInfo = document.createElement('span');
                userInfo.style.color = '#666';
                userInfo.style.fontSize = '0.9rem';
                userInfo.textContent = email;
                
                const logoutBtn = document.createElement('button');
                logoutBtn.id = 'logoutBtn';
                logoutBtn.textContent = 'üö™ Sair';
                logoutBtn.className = 'btn-secondary';
                logoutBtn.style.padding = '8px 16px';
                logoutBtn.style.fontSize = '0.9rem';
                logoutBtn.onclick = async () => {
                    if (confirm('Deseja realmente sair?')) {
                        await signOut(auth);
                        window.location.href = 'index.html';
                    }
                };
                
                logoutDiv.appendChild(userInfo);
                logoutDiv.appendChild(logoutBtn);
                header.appendChild(logoutDiv);
            }
        }

        // Sync with Firestore
        async function syncWithFirestore() {
            try {
                // Load from Firestore
                const reservasSnap = await getDocs(collection(db, 'reservas'));
                const contatosSnap = await getDocs(collection(db, 'contatos'));
                
                const firestoreReservas = [];
                reservasSnap.forEach(doc => firestoreReservas.push({id: doc.id, ...doc.data()}));
                
                const firestoreContatos = [];
                contatosSnap.forEach(doc => firestoreContatos.push({id: doc.id, ...doc.data()}));
                
                // Merge with localStorage
                const localReservas = JSON.parse(localStorage.getItem('reservas') || '[]');
                const localContatos = JSON.parse(localStorage.getItem('contatos') || '[]');
                
                // If Firestore is empty but localStorage has data, upload to Firestore
                if (firestoreReservas.length === 0 && localReservas.length > 0) {
                    console.log('üì§ Uploading local data to Firestore...');
                    for (const reserva of localReservas) {
                        await addDoc(collection(db, 'reservas'), reserva);
                    }
                }
                
                if (firestoreContatos.length === 0 && localContatos.length > 0) {
                    for (const contato of localContatos) {
                        await addDoc(collection(db, 'contatos'), contato);
                    }
                }
                
                // If Firestore has data, use it
                if (firestoreReservas.length > 0) {
                    localStorage.setItem('reservas', JSON.stringify(firestoreReservas));
                    window.location.reload();
                }
                
                if (firestoreContatos.length > 0) {
                    localStorage.setItem('contatos', JSON.stringify(firestoreContatos));
                }
                
                console.log('‚úÖ Sync complete');
                
                // Intercept localStorage.setItem to also save to Firestore
                const originalSetItem = localStorage.setItem;
                localStorage.setItem = function(key, value) {
                    originalSetItem.call(this, key, value);
                    if (key === 'reservas' || key === 'contatos') {
                        syncToFirestore(key, value);
                    }
                };
                
                async function syncToFirestore(key, value) {
                    try {
                        const data = JSON.parse(value);
                        const collectionName = key;
                        
                        // Clear collection
                        const snapshot = await getDocs(collection(db, collectionName));
                        for (const docSnap of snapshot.docs) {
                            await deleteDoc(doc(db, collectionName, docSnap.id));
                        }
                        
                        // Add all items
                        for (const item of data) {
                            const {id, ...itemData} = item;
                            await addDoc(collection(db, collectionName), itemData);
                        }
                        
                        console.log(`‚úÖ Synced ${collectionName} to Firestore`);
                    } catch (error) {
                        console.error('Error syncing to Firestore:', error);
                    }
                }
                
            } catch (error) {
                console.error('Error syncing:', error);
            }
        }
    </script>

</body>
</html>